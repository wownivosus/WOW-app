(function(){angular.module("ngOpenFB",["ngCordova.plugins.inAppBrowser"]).factory("$openFB",["$window","$q","$rootScope","$http","$timeout","$cordovaInAppBrowser",function(e,o,n,t,r,a){var i,s,c,u,l,p,d,f,h,v;return i="https://www.facebook.com/dialog/oauth",s="https://www.facebook.com/logout.php",v=e.sessionStorage,l=e.location.pathname.substring(0,window.location.pathname.indexOf("/",2)),f=location.port?":"+location.port:"",c=location.protocol+"//"+location.hostname+f+l,u=c+"/oauthcallback.html",p="https://www.facebook.com/connect/login_success.html",h=!1,d=void 0,document.addEventListener("deviceready",function(){return h=!0},!1),{init:function(e){if(!e.appId)throw"appId parameter not set in init()";return d=e.appId,e.browserOauthCallback&&(u=e.browserOauthCallback),e.cordovaOauthCallback&&(p=e.cordovaOauthCallback),e.logoutCallback&&(u=e.logoutCallback),e.tokenStore?v=e.tokenStore:void 0},isLoggedIn:function(e){var n,t,r;return t=o.defer(),r=v.fbtoken,n={},null!=r&&"undefined"!==r?(n={status:"connected",authResponse:{token:r}},t.resolve(n)):(delete v.fbtoken,n={status:"unknown"},t.reject(n)),e&&e(n),t.promise},login:function(e,t){var s,c,l,f,v,m,w,k;if(null==e)throw"login() requires options paramter";if(null==e.scope||"string"!=typeof e.scope)throw'login() options require scope parameter. E.g. "email,user_friends". Find information on scopes here https://developers.facebook.com/docs/facebook-login/permissions/v2.3';return w=o.defer(),f=function(e){return function(o,n){var i,s;return s=n.url,s.indexOf("access_token=")>0||s.indexOf("error=")>0?(i=600-((new Date).getTime()-k),r(function(){return a.close()},Math.max(i,0)),l(),c(),e.oauthCallback(s,w,t)):void 0}}(this),s=function(){var e;return console.log("exit and remove listeners"),e={error:"user_cancelled",error_description:"User cancelled login process",error_reason:"user_cancelled"},t&&t(e,null),w.reject(e),l(),c()},null!=d?(k=(new Date).getTime(),v="yes",null!=e.location&&(v=e.location?"yes":"no"),h?(m=i+"?client_id="+d+"&redirect_uri="+p+"&response_type=token&scope="+e.scope,l=n.$on("$cordovaInAppBrowser:loadstart",f),c=n.$on("$cordovaInAppBrowser:exit",s),a.open(m,"_blank",{location:v})):(m=i+"?client_id="+d+"&redirect_uri="+u+"&response_type=token&scope="+e.scope,window.open(m,"_blank","location="+v),n.$on("ngOpenFB:loadend",function(e){return function(o,n){return e.oauthCallback(n,w,t)}}(this)))):r(function(){var e;return e={status:"unknown",error:"Facebook App Id not set"},t&&t(e),w.reject(e)}),w.promise},oauthCallback:function(e,o,n){var t,r,a,i;return a=function(e){var o,n,t,r,a,i,s;for(i=decodeURIComponent(e),t={},a=i.split("&"),o=0,n=a.length;n>o;o++)r=a[o],s=r.split("="),t[s[0]]=s[1];return t},0<e.indexOf("access_token=")?(i=e.substr(e.indexOf("#")+1),r=a(i),v.fbtoken=r.access_token,t={status:"connected",authResponse:{token:r.access_token}},n&&n(null,t),o.resolve(t)):0<e.indexOf("error=")?(i=e.substring(e.indexOf("?")+1,e.indexOf("#")),r=a(i),t={status:"not_authorized",error:r.error},n&&n(t,null),o.reject(t)):(t={status:"not_authorized"},n&&n(t,null),o.reject(t))},api:function(e,n){var r,a,i,s,c,u;return a=o.defer(),s=function(e){var o,n,t;n=[];for(o in e)t=e[o],e.hasOwnProperty(o)&&n.push(encodeURIComponent(o)+"="+encodeURIComponent(t));return n.join("&")},r=e.params||{},u=new XMLHttpRequest,r.access_token=v.fbtoken,i=s(r),c="https://graph.facebook.com"+e.path+"?"+i,t({method:e.method||"GET",url:c}).then(function(e){return n&&n(null,e),a.resolve(e.data)},function(e){return n&&n(e,null),a.reject(e)}),a.promise},revokePermissions:function(e){var n;return n=o.defer(),this.api({method:"DELETE",path:"/me/permissions"}).then(function(o){return v.fbtoken=void 0,e&&e(null,o),n.resolve()},function(o){return e&&e(o,null),n.reject()}),n.promise}}}]),angular.module("ngCordova.plugins.inAppBrowser",[]).provider("$cordovaInAppBrowser",[function(){var e,o=this.defaultOptions={};this.setDefaultOptions=function(e){o=angular.extend(o,e)},this.$get=["$rootScope","$q","$window","$timeout",function(n,t,r,a){return{open:function(i,s,c){var u=t.defer();if(c&&!angular.isObject(c))return u.reject("options must be an object"),u.promise;var l=angular.extend({},o,c),p=[];angular.forEach(l,function(e,o){p.push(o+"="+e)});var d=p.join();return e=r.open(i,s,d),e.addEventListener("loadstart",function(e){a(function(){n.$broadcast("$cordovaInAppBrowser:loadstart",e)})},!1),e.addEventListener("loadstop",function(e){u.resolve(e),a(function(){n.$broadcast("$cordovaInAppBrowser:loadstop",e)})},!1),e.addEventListener("loaderror",function(e){u.reject(e),a(function(){n.$broadcast("$cordovaInAppBrowser:loaderror",e)})},!1),e.addEventListener("exit",function(e){a(function(){n.$broadcast("$cordovaInAppBrowser:exit",e)})},!1),u.promise},close:function(){e.close(),e=null},show:function(){e.show()},executeScript:function(o){var n=t.defer();return e.executeScript(o,function(e){n.resolve(e)}),n.promise},insertCSS:function(o){var n=t.defer();return e.insertCSS(o,function(e){n.resolve(e)}),n.promise}}}]}])}).call(this);